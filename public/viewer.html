<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Handy A - Viewer</title>
    <style>
        body { 
            background: #000; 
            color: white; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            margin: 0; 
            overflow: hidden; 
        }
        video, img { max-width: 100%; max-height: 100vh; }
        img { object-fit: contain; } 
    </style>
</head>
<body>
    <video id="videoPlayer" controls>
        <source src="https://www.w3schools.com/html/mov_bbb.mp4" type="video/mp4">
    </video>
    <img id="photoDisplay" style="display: none;">

    <script>
        const video = document.getElementById('videoPlayer');
        const img = document.getElementById('photoDisplay');
        let photoReady = false; 

        // 1. ÜBERWACHUNG DER FERNBEDIENUNG (Remote Start)
        setInterval(() => {
            if (localStorage.getItem('remote_start_video')) {
                console.log("Remote-Start Signal empfangen!");
                localStorage.removeItem('remote_start_video'); // Signal löschen
                video.play(); // Video starten
            }
        }, 100);

        // 2. LOGIK WÄHREND DAS VIDEO LÄUFT
        video.onplay = () => { 
            console.log("Video gestartet...");
            
            // Vollbild aktivieren
            if (video.requestFullscreen) {
                video.requestFullscreen().catch(err => console.log("Vollbild blockiert:", err));
            }
        
            // Nach 2 Sekunden den Kamera-Trigger senden
            setTimeout(() => {
                console.log("Sende Auslöse-Befehl an Kamera!");
                localStorage.setItem('trigger_camera', Date.now()); 
            }, 2000); 
        };

        // 3. HINTERGRUND-CHECK: IST DAS FOTO SCHON DA?
        // Wir schauen ständig nach, ob das Bild im Speicher liegt
        setInterval(() => {
            const savedPhoto = localStorage.getItem('shared_photo');
            if (savedPhoto && !photoReady) {
                console.log("Foto empfangen und im Hintergrund geladen.");
                img.src = savedPhoto; // Bildquelle setzen (lädt im Hintergrund)
                photoReady = true;
                localStorage.removeItem('shared_photo'); // Speicher direkt leeren
            }
        }, 500);

        // 4. VIDEO-ENDE: JETZT DAS BILD ZEIGEN
        video.onended = () => {
            console.log("Video beendet.");
            if (photoReady) {
                video.style.display = 'none';
                img.style.display = 'block';
                
                // Optional: Auch das Bild im Vollbild zeigen
                if (img.requestFullscreen) {
                    img.requestFullscreen().catch(err => console.log(err));
                }
            } else {
                console.log("Video zu Ende, aber Foto wurde noch nicht empfangen.");
                // Hier könnte man eine Fehlermeldung oder einen Loader einbauen
            }
        };

    </script>
</body>
</html>